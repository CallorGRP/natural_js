<div id="c">
	<div class="intro">
		<h1><b>Communicator</b> : Communicator(N.comm)는 Communicator 를 이용하여 서버로 부터 JSON 데이터를 가져오고 컴포넌트의 데이터나 파라미터를 서버로 다시 보내는 등의 역할을 수행 합니다.</h1>
		<h2>[Get json data from server or file] 버튼을 클릭하면 서버로 부터 JSON 데이터(/Natural-JS/prototype/data/grid.json)를 가져옵니다</h2>
		<h2>[Page embed] 버튼을 클릭하면 서버로 지정한 페이지를 가져와 지정한 영역에 표시 해 줍니다.</h2>
		<h2>Communicator 로 JSON 데이터가 아닌 HTML 페이지를 불러올경우 불러온 페이지의 Service Controller(N.sc) 의 멤버변수로 request(this.request) 객체를 자동으로 지정 해 줍니다. 
		<br />request 객체는 다음과 같은 기능을 제공 해 줍니다.<br />
			 + attr(name, obj) : obj인자를 입력하면 obj<br />
			 + param(name) : obj인자를 입력하면 obj<br />
			 + get(key) : Communicator 호출시 적용된 request 의 기본옵션과  정보 값을 가져옵니다. 정보값은 다음과 같습니다.<br />
			 &nbsp;* referrer : (String)호줄한 페이지의 URL<br />
			 &nbsp;* contentType : (String)호출했을때의 contentType<br />
			 &nbsp;* type : (String)호출 메소드(POST, GET 등)<br />
			 &nbsp;* async : (boolean)Ajax 비동기 호출 유무<br />
			 &nbsp;* urlSync : (boolean)호출했을때의 URL과 응답 시의 URL 을 비교하여 틀리면 응답을 중단 시킴<br />
			 &nbsp;* append : (boolean)불러온 HTML 을 지정한 영역에 더할건지 덮어쓸건지 결정<br />
			 &nbsp;* effect : (false or array) 페이지 전환 효과 적용 유무, 적용시 ["effect", duration(ms), callBack] 으로 지정
		</h2>
	</div>
	<div class="divBar">DEMO</div>
	<div class="demoBox">
		<div class="btnBox" align="center">
			<a id="btnGetJson" href="#" class='{ "color": "skyblue", "size": "large" }'>Get json data from server or file</a>
		</div>
		
		<p>Result : </p>
		<div class="result" style="height: 100px;"></div>
		
		<p>Default options : </p>
		<table class="form" style="width: 100%;">
			<tr>
				<th width="10%" align="right">context</th>
				<td width="40%"><input id="context" type="text" value="div.result:eq(1)" readonly="readonly" /> Target context</td>	
				<th width="10%" align="right">url</th>
				<td width="40%"><input id="url" type="text" value="prototype/datepicker.html" /> Target url</td>			
			</tr>
			<tr>
				<th align="right">async</th>
				<td><input id="async" type="checkbox" checked="checked" /> If uncheck(false) this checkbox, set synchronous to ajax request</td>
				<th align="right">type</th>
				<td width="40%"><input id="type" type="text" value="POST" /> Request method</td>
			</tr>
			<tr>
				<th align="right">effect<br />[effect, duration, callback]</th>
				<td colspan="3">[ <input id="effect" type="text" value="slideDown" style="width: 50px;" />,
					<input id="duration" type="text" value="300" style="width: 50px;" />,
					<textarea id="callback" rows="3" cols="30">
function() {
	N.log("Effect end");
}
					</textarea> ]
					 * effects : show, hide, slideUp, slideDown, fadeIn, fadeOut
				</td>
			</tr>
		</table>
		
		<p>Method options : </p>
		<table class="form" style="width: 100%;">
			<tr>
				<th align="right" width="10%">submit</th>
				<th align="right" width="10%">arguments[0]</th>
				<td width="80%" colspan="3"><textarea id="jsonCallback" rows="5" cols="60">
function(data) {
	N("div.result:eq(0)", view).text(JSON.stringify(data));
}
				</textarea><br /> Success callback function</td>
			</tr>
		</table>
		
		<div class="btnBox" align="center">
			<a id="btnGetPage" href="#" class='{ "color": "skyblue", "size": "large" }'>Page embed</a>
		</div>
		
		<p>Result : </p>
		<div class="result" style="height: 600px;"></div>
	</div>

	<div class="divBar">SOURCE CODE</div>
	<div class="sourceBox">
	</div>
</div>

<script type="text/javascript">

N("div#c").sc({
    init : function(view, request) {
    	// put source code
    	IndexServiceController.getSourceCode(request.get("url"), N("div.sourceBox"));

    	// initialize buttons in div.btnBox
    	this.initButton(view);

    	// bind events
    	this.setEvent(view, this);
    },
    initButton : function(view) {
    	N("div.btnBox", view).button();
    },
    setEvent : function(view, this_) {
    	N("a#btnGetJson", view).click(function(e) {
            e.preventDefault();
            N.comm({
        		url : "prototype/data/grid.json"
        	}).submit(eval("(" + N("textarea#jsonCallback", view).val() + ")"));
        });

    	N("a#btnGetPage", view).click(function(e) {
            e.preventDefault();
            var opts = {
            	url : N("input#url", view).val(),
            	async : N("input#async", view).is(":checked"),
            	type : N("input#type", view).val(),
        		effect : N.string.trimToNull(N("input#effect", view).val()) === null ? false :
      				[N("input#effect", view).val(),
      		        parseInt(N("input#duration", view).val()),
      		        N.string.trimToNull(N("textarea#callback", view).val()) !== null ?
						eval("(" + N("textarea#callback", view).val() + ")") : undefined ]
            }
            N(N("input#context", view).val(), view).comm(opts).submit();
        });
    }
});

</script>