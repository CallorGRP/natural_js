/*
 Natural-ARCHITECTURE v0.8.1.13
 bbalganjjm@gmail.com

 Copyright 2014 KIM HWANG MAN
 Released under the LGPL license

 Date: 2014-09-26T11:11Z
*/
(function(r,f){N.version["Natural-ARCHITECTURE"]="0.8.1.13";f.fn.extend(f.extend(N.prototype,{ajax:function(d){return N.ajax(d)},comm:function(d){return new N.comm(this,d)},request:function(){return this.get(0).request},cont:function(d){return new N.cont(this,d)}}));(function(d){d.ajax=f.ajax;var g=d.comm=function(a,b){void 0===a?d.error("[Communicator]You must input arguments[0]"):(d.isPlainObject(a)||d.isString(a))&&void 0===b&&(b=a,a=f());a.request=new g.request(a,d.isString(b)?{url:b}:b);f(f.map(g,
function(a,b){if("function"===d.type(g[b])&&"request"!==b)return b})).each(function(b,c){a[c]=function(b){return g[c].call(a,b)}});return a};f.extend(g,{xhr:null,submit:function(a){var b=this;d.isElement(b)&&(f.extend(this.request.options,{contentType:"text/html; charset=UTF-8",dataType:"html",type:"GET"}),this.request.options.target=b);var h=[],c=[],g=[],n=[],k=[],e=d.context.attr("architecture").comm.filters,q=[],t=d.context.attr("core").spltSepa,l;for(l in e)void 0!==e[l].order&&q.push(e[l].order+
t+l);q.sort();for(l in e)void 0===e[l].order&&q.push(l);f(q).each(function(){var b=this.split(t),b=1<b.length?b[1]:b[0],a;for(a in e[b])"afterInit"===a?h.push(e[b][a]):"beforeSend"===a?c.push(e[b][a]):"success"===a?g.push(e[b][a]):"error"===a?n.push(e[b][a]):"complete"===a&&k.push(e[b][a])});var u=!1;f(h).each(function(a){if(this(b.request)instanceof Error)return u=!0,!1});if(!u)return f.extend(b.request.options,{beforeSend:function(a,d){var p=!1;f(c).each(function(c){if(this(b.request,a,d)instanceof
Error)return p=!0,!1});if(p)return!1},success:function(c,k,e){var p=!1;f(g).each(function(a){a=this(b.request,c,k,e);if(a instanceof Error)return p=!0,!1;void 0!==a&&(c=a)});if(p)return!1;if(d.isElement(b)){if(b.is(d.context.attr("architecture").page.context))d.gc[d.context.attr("core").gcMode]();b.request.options.append?b.append(c):b.request.options.replace?(b.attr("id",b.attr("id")+"_pending_to_remove"),b.css("display","none"),b.after(c)):b.html(c);if(b.request.options.effect)b.hide()[b.request.options.effect[0]](b.request.options.effect[1],
b.request.options.effect[2]);if(b.request.options.replace){if(0<b.nextAll(".view_context__:first").length){var h=b.nextAll(".view_context__:first").instance("cont");void 0!==h&&m.trInit.call(this,h,b.request)}b.remove()}else 0<b.children(".view_context__:last").length&&(h=b.children(".view_context__:last").instance("cont"),void 0!==h&&m.trInit.call(this,h,b.request))}else if(b.request.options.urlSync&&b.request.options.referrer.replace(/!/g,"")!=r.location.href.replace(/!/g,""))return e.abort(),!1;
if(void 0!==a)try{a.call(b,c,b.request)}catch(w){d.error("[Communicator.submit.success.callback]"+w,w)}},error:function(a,c,k){f(n).each(function(d){if(this(b.request,a,c,k)instanceof Error)return!1});d.error("[N.ajax."+c+"]"+k,k)},complete:function(a,c){f(k).each(function(d){if(this(b.request,a,c)instanceof Error)return!1})}}),this.xhr=d.ajax(b.request.options),b}});g.request=function(a,b){this.options={referrer:r.location.href,contentType:"application/json; charset=utf-8",cache:!1,async:!0,type:"POST",
data:null,dataIsArray:!1,dataType:"json",urlSync:!0,crossDomain:!1,browserHistory:!0,append:!1,effect:!1,target:null};try{f.extend(this.options,d.context.attr("architecture").comm.request.options)}catch(x){}f.extend(this.options,b);this.attrObj={};this.obj=a;d.isWrappedSet(a)?d.isElement(a)||(this.options.data=JSON.stringify(this.options.dataIsArray?a.get():a.get(0))):null!=a&&(this.options.data=JSON.stringify(a));if(null!=this.options.data&&"GET"===this.options.type.toUpperCase()){var h=this.options.data.charAt(0),
c=this.options.data.charAt(this.options.data.length-1);if("{"===h&&"}"===c||"["===h&&"]"===c)this.options.data="q="+encodeURI(this.options.data)}};f.fn.extend(g.request.prototype,{attr:function(a,b){if(void 0===a)return this.attrObj;if(void 0===b)return void 0!==this.attrObj&&void 0!==this.attrObj[a]?this.attrObj[a]:void 0;void 0===this.attrObj&&(this.attrObj={});this.attrObj[a]=b;return this.obj},removeAttr:function(a){void 0!=this.attrObj[a]&&delete this.attrObj[a];return this},param:function(a){if(d.isEmptyObject(a)){if(0>
this.options.url.indexOf("?"))return{};a={};for(var b=this.options.url.split("?")[1].substring(1).split("&"),f=0;f<b.length;f++){var c=b[f].split("=");c[0]&&(a[c[0]]=decodeURIComponent(c[1])||!0)}return a}return this.param()[a]},get:function(a){return void 0!==a?this.options[a]:this.options},reload:function(a){var b=this.options.target.comm(this.options.url);b.request=this;b.submit(a);return this}});var m=d.cont=function(a,b){void 0!==a.attr("id")&&1<d("[id='"+a.attr("id")+"']").length&&(a=d("#"+
a.attr("id")+":not(.view_context__)"));var f=a.selector;1<a.length&&(a=d(a.selector+":not(.view_context__)"),a.selector=f);a.attr("data-pageid",a.attr("id")?a.attr("id"):a.selector.replace(/\.|\#|\[|\]|\'|\:|\(|\)|\>| |\-/gi,""));a.addClass("view_context__");a.instance("cont",b);b.view=a;return b};f.extend(m,{trInit:function(a,b){a.request=b;m.aop.wrap.call(this,a);void 0!==a.init&&a.init(a.view,b)},aop:{pointcuts:{regexp:{fn:function(a,b,d){return(a instanceof RegExp?a:new RegExp(a)).test(d)}}},
wrap:function(a){if(d.context.attr("architecture").cont&&d.context.attr("architecture").cont.advisors&&0<d.context.attr("architecture").cont.advisors.length){var b=d.context.attr("architecture").cont;f(b.advisors).each(function(h,c){var g;d.isPlainObject(c.pointcut)||(c.pointcut={type:"regexp",param:c.pointcut},d.isString(c.pointcut.param)&&(c.pointcut.selector=c.pointcut.selector||c.pointcut.param.substring(0,c.pointcut.param.lastIndexOf(":")),c.pointcut.param=c.pointcut.param.substring(c.pointcut.param.lastIndexOf(":")+
1)));(g=b.pointcuts?b.pointcuts[c.pointcut.type]||m.aop.pointcuts[c.pointcut.type]:m.aop.pointcuts[c.pointcut.type])||d.error("[Controller]Unkown pointcut type : "+c.pointcut.type);if(!c.pointcut.selector||a.view.is(c.pointcut.selector)){var n=function(a,b){for(var e in a)a.hasOwnProperty(e)&&(f.isFunction(a[e])?g.fn(c.pointcut.param,a,b+e)&&(a[e]=function(d,f){switch(c.adviceType){case "before":var e=function(){var e=[].slice.call(arguments);c.fn.call(c,a,b+f,e);return d.apply(a,e)};break;case "after":e=
function(){var e=[].slice.call(arguments),g=d.apply(a,e);c.fn.call(c,a,b+f,e,g);return g};break;case "around":e=function(){var e=[].slice.call(arguments);return c.fn.call(c,a,b+f,e,{contFrag:a,args:e,real:d,proceed:function(){return this.real.apply(this.contFrag,this.args)}})};break;case "error":e=function(){var e=[].slice.call(arguments);try{var g=d.apply(a,e)}catch(v){if("error"==c.adviceType)g=c.fn.call(c,a,b+f,e,v);else throw v;}return g}}return e}(a[e],e)):d.isPlainObject(a[e])&&n.call(this,
a[e],b+e+"."))};n.call(this,a,"")}})}}}});d.context={attrObj:{},attr:g.request.prototype.attr}})(N)})(window,jQuery);
