/*
 Natural-ARCHITECTURE v0.8.0.18
 bbalganjjm@gmail.com

 Copyright 2014 KIM HWANG MAN
 Released under the LGPL license

 Date: 2014-09-26T11:11Z
*/
(function(n,e){N.version["Natural-ARCHITECTURE"]="0.8.0.18";e.fn.extend(e.extend(N.prototype,{ajax:function(c){return N.ajax(c)},comm:function(c){return new N.comm(this,c)},request:function(){return this.get(0).request},cont:function(c){return new N.cont(this,c)}}));(function(c){c.ajax=e.ajax;var k=c.comm=function(a,b){void 0===a?c.error("[Communicator]You must input arguments[0]"):(c.isPlainObject(a)||c.isString(a))&&void 0===b?(b=a,a=[]):c.isWrappedSet(a)||c.isArray(a)||(a=[a]);a.request=new k.request(a,
c.isString(b)?{url:b}:b);e(e.map(k,function(a,b){if("function"===c.type(k[b])&&"request"!==b)return b})).each(function(b,c){a[c]=function(b){return k[c].call(a,b)}});return a};e.extend(k,{xhr:null,submit:function(a){var b=this;c.isElement(b)&&(e.extend(this.request.options,{contentType:"text/html; charset=UTF-8",dataType:"html",type:"GET"}),this.request.options.target=b);var d=[],g=[],k=[],p=[],q=[],l=c.context.attr("architecture").comm.filters,m;for(m in l)for(var h in l[m])"afterInit"===h?d.push(l[m][h]):
"beforeSend"===h?g.push(l[m][h]):"success"===h?k.push(l[m][h]):"error"===h?p.push(l[m][h]):"complete"===h&&q.push(l[m][h]);e(d).each(function(a){this(b.request)});e.extend(b.request.options,{beforeSend:function(a,c){e(g).each(function(e){this(b.request,a,c)})},success:function(d,h,g){e(k).each(function(a){a=this(b.request,d,h,g);void 0!==a&&(d=a)});if(c.isElement(b)){if(b.is(c.context.attr("architecture").page.context))c.gc[c.context.attr("core").gcMode]();b.request.options.append?b.append(d):b.html(d);
if(b.request.options.effect)b.hide()[b.request.options.effect[0]](b.request.options.effect[1],b.request.options.effect[2]);if(0<b.children("[id]:first").length){var f=b.children("[id]:first").instance("cont");if(void 0!==f){f.request=b.request;if(c.context.attr("architecture").cont&&c.context.attr("architecture").cont.advisors&&0<c.context.attr("architecture").cont.advisors.length){var l=c.context.attr("architecture").cont;e(l.advisors).each(function(a,b){if(!b.selector||f.view.is(b.selector)){var c=
e.isPlainObject(b.pointcut)?l.pointcuts[b.type]:l.pointcuts.regexp;for(var d in f)f.hasOwnProperty(d)&&c.fn(b.pointcut,f,d)&&(f[d]=function(a,c){switch(b.adviceType){case "before":var d=function(){var d=[].slice.call(arguments);b.fn.call(b,f,c,d);return a.apply(f,d)};break;case "after":d=function(){var d=[].slice.call(arguments),e=a.apply(f,d);b.fn.call(b,f,c,d,e);return e};break;case "around":d=function(){var d=[].slice.call(arguments);return b.fn.call(b,f,c,d,{sc:f,args:d,real:a,proceed:function(){return this.real.apply(this.sc,
this.args)}})};break;case "error":d=function(){var d=[].slice.call(arguments);try{var e=a.apply(f,d)}catch(t){if("error"==b.adviceType)e=b.fn.call(b,f,c,d,t);else throw t;}return e}}return d}(f[d],d))}})}void 0!==f.init&&f.init(f.view,b.request)}}}else if(b.request.options.urlSync&&b.request.options.referrer.replace(/!/g,"")!=n.location.href.replace(/!/g,""))return g.abort(),!1;if(void 0!==a)try{a.call(b,d,b.request)}catch(r){c.error("[Communicator.submit.success.callback]"+r,r)}},error:function(a,
d,g){e(p).each(function(c){this(b.request,a,d,g)});c.error("[N.ajax."+d+"]"+g,g)},complete:function(a,c){e(q).each(function(d){this(b.request,a,c)})}});this.xhr=c.ajax(b.request.options);return b}});k.request=function(a,b){this.options={referrer:n.location.href,contentType:"application/json; charset=utf-8",cache:!1,async:!0,type:"POST",data:null,dataType:"json",urlSync:!0,crossDomain:!1,browserHistory:!0,append:!1,effect:!1,target:null};try{e.extend(this.options,c.context.attr("architecture").comm.request.options)}catch(u){}e.extend(this.options,
b);this.attrObj={};this.obj=a;c.isString(this.options.data)||(this.options.data=JSON.stringify(null===this.options.data?c.isWrappedSet(a)?c.isElement(a)?void 0:a.toArray()[0]:a[0]:this.options.data));if(void 0!==this.options.data&&"GET"===this.options.type.toUpperCase()){var d=this.options.data.charAt(0),g=this.options.data.charAt(this.options.data.length-1);if("{"===d&&"}"===g||"["===d&&"]"===g)this.options.data="q="+encodeURI(this.options.data)}};e.fn.extend(k.request.prototype,{attr:function(a,
b){if(void 0===a)return this.attrObj;if(void 0===b)return void 0!==this.attrObj&&void 0!==this.attrObj[a]?this.attrObj[a]:void 0;void 0===this.attrObj&&(this.attrObj={});this.attrObj[a]=b;return this.obj},removeAttr:function(a){void 0!=this.attrObj[a]&&delete this.attrObj[a];return this},param:function(a){if(c.isEmptyObject(a)){if(0>this.options.url.indexOf("?"))return{};a={};for(var b=this.options.url.split("?")[1].substring(1).split("&"),d=0;d<b.length;d++){var e=b[d].split("=");e[0]&&(a[e[0]]=
decodeURIComponent(e[1])||!0)}return a}return this.param()[a]},get:function(a){return void 0!==a?this.options[a]:this.options}});c.cont=function(a,b){1<c("[id='"+a.attr("id")+"']").length&&(a=c("#"+a.attr("id")+":not(.view_context__)"));if(void 0===b)return a.data(a.attr("id"));1<a.length&&(a=c(e.grep(a,function(b){return!e(b).hasClass(a.attr("id")+"__ view_context__")})));a.addClass(a.attr("id")+"__ view_context__");a.instance("cont",b);b.view=a;return b};c.context={attrObj:{},attr:k.request.prototype.attr}})(N)})(window,
jQuery);
