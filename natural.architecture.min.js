/*
 Natural-ARCHITECTURE v0.8.1.7
 bbalganjjm@gmail.com

 Copyright 2014 KIM HWANG MAN
 Released under the LGPL license

 Date: 2014-09-26T11:11Z
*/
(function(q,f){N.version["Natural-ARCHITECTURE"]="0.8.1.7";f.fn.extend(f.extend(N.prototype,{ajax:function(c){return N.ajax(c)},comm:function(c){return new N.comm(this,c)},request:function(){return this.get(0).request},cont:function(c){return new N.cont(this,c)}}));(function(c){c.ajax=f.ajax;var g=c.comm=function(a,b){void 0===a?c.error("[Communicator]You must input arguments[0]"):(c.isPlainObject(a)||c.isString(a))&&void 0===b&&(b=a,a=f());a.request=new g.request(a,c.isString(b)?{url:b}:b);f(f.map(g,
function(a,b){if("function"===c.type(g[b])&&"request"!==b)return b})).each(function(b,c){a[c]=function(b){return g[c].call(a,b)}});return a};f.extend(g,{xhr:null,submit:function(a){var b=this;c.isElement(b)&&(f.extend(this.request.options,{contentType:"text/html; charset=UTF-8",dataType:"html",type:"GET"}),this.request.options.target=b);var k=[],e=[],g=[],m=[],h=[],d=c.context.attr("architecture").comm.filters,n=[],r=c.context.attr("core").spltSepa,l;for(l in d)void 0!==d[l].order&&n.push(d[l].order+
r+l);n.sort();for(l in d)void 0===d[l].order&&n.push(l);f(n).each(function(){var a=this.split(r),a=1<a.length?a[1]:a[0],b;for(b in d[a])"afterInit"===b?k.push(d[a][b]):"beforeSend"===b?e.push(d[a][b]):"success"===b?g.push(d[a][b]):"error"===b?m.push(d[a][b]):"complete"===b&&h.push(d[a][b])});f(k).each(function(a){this(b.request)});f.extend(b.request.options,{beforeSend:function(a,c){f(e).each(function(e){this(b.request,a,c)})},success:function(e,h,d){f(g).each(function(a){a=this(b.request,e,h,d);
void 0!==a&&(e=a)});if(c.isElement(b)){if(b.is(c.context.attr("architecture").page.context))c.gc[c.context.attr("core").gcMode]();b.request.options.append?b.append(e):b.html(e);if(b.request.options.effect)b.hide()[b.request.options.effect[0]](b.request.options.effect[1],b.request.options.effect[2]);if(0<b.children(".view_context__:last").length){var t=b.children(".view_context__:last").instance("cont");void 0!==t&&p.trInit.call(this,t,b.request)}}else if(b.request.options.urlSync&&b.request.options.referrer.replace(/!/g,
"")!=q.location.href.replace(/!/g,""))return d.abort(),!1;if(void 0!==a)try{a.call(b,e,b.request)}catch(u){c.error("[Communicator.submit.success.callback]"+u,u)}},error:function(a,e,h){f(m).each(function(c){this(b.request,a,e,h)});c.error("[N.ajax."+e+"]"+h,h)},complete:function(a,c){f(h).each(function(e){this(b.request,a,c)})}});this.xhr=c.ajax(b.request.options);return b}});g.request=function(a,b){this.options={referrer:q.location.href,contentType:"application/json; charset=utf-8",cache:!1,async:!0,
type:"POST",data:null,dataIsArray:!1,dataType:"json",urlSync:!0,crossDomain:!1,browserHistory:!0,append:!1,effect:!1,target:null};try{f.extend(this.options,c.context.attr("architecture").comm.request.options)}catch(w){}f.extend(this.options,b);this.attrObj={};this.obj=a;c.isWrappedSet(a)?c.isElement(a)||(this.options.data=JSON.stringify(this.options.dataIsArray?a.get():a.get(0))):null!=a&&(this.options.data=JSON.stringify(a));if(null!=this.options.data&&"GET"===this.options.type.toUpperCase()){var k=
this.options.data.charAt(0),e=this.options.data.charAt(this.options.data.length-1);if("{"===k&&"}"===e||"["===k&&"]"===e)this.options.data="q="+encodeURI(this.options.data)}};f.fn.extend(g.request.prototype,{attr:function(a,b){if(void 0===a)return this.attrObj;if(void 0===b)return void 0!==this.attrObj&&void 0!==this.attrObj[a]?this.attrObj[a]:void 0;void 0===this.attrObj&&(this.attrObj={});this.attrObj[a]=b;return this.obj},removeAttr:function(a){void 0!=this.attrObj[a]&&delete this.attrObj[a];return this},
param:function(a){if(c.isEmptyObject(a)){if(0>this.options.url.indexOf("?"))return{};a={};for(var b=this.options.url.split("?")[1].substring(1).split("&"),f=0;f<b.length;f++){var e=b[f].split("=");e[0]&&(a[e[0]]=decodeURIComponent(e[1])||!0)}return a}return this.param()[a]},get:function(a){return void 0!==a?this.options[a]:this.options}});var p=c.cont=function(a,b){void 0!==a.attr("id")&&1<c("[id='"+a.attr("id")+"']").length&&(a=c("#"+a.attr("id")+":not(.view_context__)"));1<a.length&&(a=a.filter(":not(.view_context__)").filter(":last"));
a.attr("data-pageid",a.attr("id")?a.attr("id"):a.selector.replace(/\.|\#|\[|\]|\'|\:|\(|\)|\>| |\-/gi,""));a.addClass("view_context__");a.instance("cont",b);b.view=a;return b};f.extend(p,{trInit:function(a,b){a.request=b;p.aop.wrap.call(this,a);void 0!==a.init&&a.init(a.view,b)},aop:{pointcuts:{regexp:{fn:function(a,b,c){return(a instanceof RegExp?a:new RegExp(a)).test(c)}}},wrap:function(a){if(c.context.attr("architecture").cont&&c.context.attr("architecture").cont.advisors&&0<c.context.attr("architecture").cont.advisors.length){var b=
c.context.attr("architecture").cont;f(b.advisors).each(function(g,e){var k=c.isPlainObject(e.pointcut)?b.pointcuts[e.pointcut.type]:p.aop.pointcuts.regexp;var m=function(a,b){for(var d in a)a.hasOwnProperty(d)&&(f.isFunction(a[d])?k.fn(e.pointcut,a,b+d)&&(a[d]=function(c,f){switch(e.adviceType){case "before":var d=function(){var d=[].slice.call(arguments);e.fn.call(e,a,b+f,d);return c.apply(a,d)};break;case "after":d=function(){var d=[].slice.call(arguments),g=c.apply(a,d);e.fn.call(e,a,b+f,d,g);
return g};break;case "around":d=function(){var d=[].slice.call(arguments);return e.fn.call(e,a,b+f,d,{contFrag:a,args:d,real:c,proceed:function(){return this.real.apply(this.contFrag,this.args)}})};break;case "error":d=function(){var d=[].slice.call(arguments);try{var g=c.apply(a,d)}catch(v){if("error"==e.adviceType)g=e.fn.call(e,a,b+f,d,v);else throw v;}return g}}return d}(a[d],d)):c.isPlainObject(a[d])&&m.call(this,a[d],b+d+"."))};m.call(this,a,a.view.selector+":")})}}}});c.context={attrObj:{},
attr:g.request.prototype.attr}})(N)})(window,jQuery);
