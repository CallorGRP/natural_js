/*
 Natural-ARCHITECTURE v0.10.3

 Released under the LGPL v2.1 license
 Date: 2014-09-26T11:11Z

 Copyright 2014 KIM HWANG MAN(bbalganjjm@gmail.com)
*/
(function(t,e){N.version["Natural-ARCHITECTURE"]="0.10.3";e.fn.extend(e.extend(N.prototype,{ajax:function(c){return N.ajax(c)},comm:function(c){return new N.comm(this,c)},request:function(){return this.get(0).request},cont:function(c){return new N.cont(this,c)}}));(function(c){c.ajax=e.ajax;var m,h=c.comm=function(a,b){void 0===a?c.error("[Communicator]You must input arguments[0]"):(c.isPlainObject(a)||c.isString(a))&&void 0===b&&(b=a,a=e());c.isPlainObject(a)&&(a=e(a));void 0===m&&(m=h.initFilterConfig());
var f=!1;e(m.beforeInitFilters).each(function(b){if((b=this(a))instanceof Error)return f=!0,!1;void 0!==b&&(a=e(b))});if(f)return a;a.request=new h.request(a,c.isString(b)?{url:b}:b);e(e.map(h,function(a,b){if("function"===c.type(h[b])&&"request"!==b)return b})).each(function(b,c){a[c]=function(b){return h[c].call(a,b)}});return a};e.extend(h,{xhr:null,initFilterConfig:function(){var a=[],b=[],f=[],d=[],q=[],k=[],g=c.context.attr("architecture").comm.filters,l=[],r=c.context.attr("core").spltSepa,
n;for(n in g)void 0!==g[n].order&&l.push(g[n].order+r+n);l.sort();for(n in g)void 0===g[n].order&&l.push(n);e(l).each(function(){var c=this.split(r),c=1<c.length?c[1]:c[0],e;for(e in g[c])"beforeInit"===e?a.push(g[c][e]):"afterInit"===e?b.push(g[c][e]):"beforeSend"===e?f.push(g[c][e]):"success"===e?d.push(g[c][e]):"error"===e?q.push(g[c][e]):"complete"===e&&k.push(g[c][e])});return{beforeInitFilters:a,afterInitFilters:b,beforeSendFilters:f,successFilters:d,errorFilters:q,completeFilters:k}},resetFilterConfig:function(){m=
h.initFilterConfig();return this},submit:function(a){var b=this;c.isElement(b)&&(e.extend(this.request.options,{contentType:"text/html; charset=UTF-8",dataType:"html",type:"GET"}),this.request.options.target=b);var f=!1;e(m.afterInitFilters).each(function(a){if(this(b.request)instanceof Error)return f=!0,!1});if(!f)return e.extend(b.request.options,{beforeSend:function(a,c){var d=!1;e(m.beforeSendFilters).each(function(e){if(this(b.request,a,c)instanceof Error)return d=!0,!1});if(d)return!1},success:function(d,
f,k){var g=!1;e(m.successFilters).each(function(a){a=this(b.request,d,f,k);if(a instanceof Error)return g=!0,!1;void 0!==a&&(d=a)});if(g)return!1;if(c.isElement(b)){if(b.is(c.context.attr("architecture").page.context))c.gc[c.context.attr("core").gcMode]();b.request.options.append?b.append(d):b.request.options.replace?(b.attr("id",b.attr("id")+"_pending_to_remove"),b.css("display","none"),b.after(d)):b.html(d);if(b.request.options.effect)b.hide()[b.request.options.effect[0]](b.request.options.effect[1],
b.request.options.effect[2]);if(b.request.options.replace){if(0<b.nextAll(".view_context__:first").length){var l=b.nextAll(".view_context__:first").instance("cont");void 0!==l&&p.trInit.call(this,l,b.request)}b.remove()}else 0<b.children(".view_context__:last").length&&(l=b.children(".view_context__:last").instance("cont"),void 0!==l&&p.trInit.call(this,l,b.request))}else if(b.request.options.urlSync&&b.request.options.referrer.replace(/!/g,"")!=t.location.href.replace(/!/g,""))return k.abort(),c.warn("[Communicator.submit.success(urlSync option)]The response was stopped because it was different from the URL at the time of the request and the URL at the time of the response."),
!1;if(void 0!==a)try{a.call(b,d,b.request)}catch(r){c.error("[Communicator.submit.success.callback]"+r,r)}},error:function(a,f,k){var d=!1;e(m.errorFilters).each(function(c){if(this(b.request,a,f,k)instanceof Error)return d=!0,!1});d||c.error("[N.ajax."+f+"]"+k,k)},complete:function(a,c){e(m.completeFilters).each(function(d){if(this(b.request,a,c)instanceof Error)return!1})}}),this.xhr=c.ajax(b.request.options),b}});h.request=function(a,b){this.options={referrer:t.location.href,contentType:"application/json; charset=utf-8",
cache:!1,async:!0,type:"POST",data:null,dataIsArray:!1,dataType:"json",urlSync:!0,crossDomain:!1,browserHistory:!0,append:!1,effect:!1,target:null};try{e.extend(this.options,c.context.attr("architecture").comm.request.options)}catch(q){}e.extend(this.options,b);this.attrObj={};this.obj=a;if(c.isWrappedSet(a)){if(!c.isElement(a))try{this.options.data=JSON.stringify(this.options.dataIsArray?a.get():a.get(0))}catch(q){this.options.data=null}}else if(null!=a)try{this.options.data=JSON.stringify(a)}catch(q){this.options.data=
null}if(null!=this.options.data&&"GET"===this.options.type.toUpperCase()){var f=this.options.data.charAt(0),d=this.options.data.charAt(this.options.data.length-1);if("{"===f&&"}"===d||"["===f&&"]"===d)this.options.data="q="+encodeURI(this.options.data)}};e.fn.extend(h.request.prototype,{attr:function(a,b){if(void 0===a)return this.attrObj;if(void 0===b)return void 0!==this.attrObj&&void 0!==this.attrObj[a]?this.attrObj[a]:void 0;void 0===this.attrObj&&(this.attrObj={});this.attrObj[a]=b;return this.obj},
removeAttr:function(a){void 0!=this.attrObj[a]&&delete this.attrObj[a];return this},param:function(a){if(c.isEmptyObject(a)){if(0>this.options.url.indexOf("?"))return{};a={};for(var b=this.options.url.split("?")[1].split("&"),e=0;e<b.length;e++){var d=b[e].split("=");d[0]&&(a[d[0]]=decodeURIComponent(d[1])||!0)}return a}return this.param()[a]},get:function(a){return void 0!==a?this.options[a]:this.options},reload:function(a){var b=this.options.target.comm(this.options.url);b.request=this;b.submit(a);
return this}});var p=c.cont=function(a,b){if(void 0!==a.attr("id")&&1<c("[id='"+a.attr("id")+"']").length)a=c("#"+a.attr("id")+":not([data-pageid])");else{var e=a.selector;1<a.length&&(a=c(a.selector+":not([data-pageid])"),a.selector=e)}a.attr("data-pageid",a.attr("id")?a.attr("id"):a.selector.replace(/\.|\#|\[|\]|\'|\:|\(|\)|\>| |\-/gi,""));a.addClass("view_context__");a.instance("cont",b);b.view=a;return b};e.extend(p,{trInit:function(a,b){a.request=b;p.aop.wrap.call(this,a);void 0!==a.init&&a.init(a.view,
b)},aop:{pointcuts:{regexp:{fn:function(a,b,c){return(a instanceof RegExp?a:new RegExp(a)).test(c)}}},wrap:function(a){if(c.context.attr("architecture").cont&&c.context.attr("architecture").cont.advisors&&0<c.context.attr("architecture").cont.advisors.length){var b=c.context.attr("architecture").cont;e(b.advisors).each(function(f,d){var h;c.isPlainObject(d.pointcut)||(d.pointcut={type:"regexp",param:d.pointcut},c.isString(d.pointcut.param)&&(d.pointcut.selector=d.pointcut.selector||d.pointcut.param.substring(0,
d.pointcut.param.lastIndexOf(":")),d.pointcut.param=d.pointcut.param.substring(d.pointcut.param.lastIndexOf(":")+1)));(h=b.pointcuts?b.pointcuts[d.pointcut.type]||p.aop.pointcuts[d.pointcut.type]:p.aop.pointcuts[d.pointcut.type])||c.error("[Controller]Unkown pointcut type : "+d.pointcut.type);if(!d.pointcut.selector||a.view.is(d.pointcut.selector)){var k=function(a,b){for(var f in a)a.hasOwnProperty(f)&&(e.isFunction(a[f])?h.fn(d.pointcut.param,a,b+f)&&(a[f]=function(c,e){switch(d.adviceType){case "before":var f=
function(){var f=[].slice.call(arguments);d.fn.call(d,a,b+e,f);return c.apply(a,f)};break;case "after":f=function(){var f=[].slice.call(arguments),g=c.apply(a,f);d.fn.call(d,a,b+e,f,g);return g};break;case "around":f=function(){var f=[].slice.call(arguments);return d.fn.call(d,a,b+e,f,{contFrag:a,args:f,real:c,proceed:function(){return this.real.apply(this.contFrag,this.args)}})};break;case "error":f=function(){var f=[].slice.call(arguments);try{var g=c.apply(a,f)}catch(u){if("error"==d.adviceType)g=
d.fn.call(d,a,b+e,f,u);else throw u;}return g}}return f}(a[f],f)):c.isPlainObject(a[f])&&k.call(this,a[f],b+f+"."))};k.call(this,a,"")}})}}}});c.context={attrObj:{},attr:h.request.prototype.attr}})(N)})(window,jQuery);
